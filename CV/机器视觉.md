# 机器视觉

## 1.1 机器视觉概念

- **机器视觉**：用机器代替人眼进行目标操作、完成作业
- **机器视觉系统**：通过机器视觉硬件（相机、镜头、光源、图像采集卡等）将采集目标转换成图像信号，传送给专用的图像处理软件，根据分布像素的亮度、颜色等信息，进行图像运算，得到相应处理结果。
- **数字图像处理**：通过计算机对图像进行去噪、增强、复原、分割、提取特征的方法和技术。

**计算机视觉**侧重于对**质的分析**，如分类识别、身份确认、行为分析等；**机器视觉**侧重于对**量的分析**，如识别零件内外径、物体计数、三维形貌测量等。

## 1.2 相关硬件

<img src="./Images/机器视觉/图 1.1.png" alt="图 1.1" style="zoom:50%;" />

光源照射被测物体，相机检测对象并采集图像，镜头光打到CCD/CMOS图像传感器上后将光信号转换为电信号，传输到图像采集卡上，图像采集卡将这一电信号转为数字图像，传到内存中，进行进一步的处理。

### 1.2.1 光源

<img src="./Images/机器视觉/图 1.2.png" alt="图 1.2" style="zoom:50%;" />

LED等可以制作成各种形状，各种颜色，可以随时调节亮度。散热效果好，光照稳定，使用寿命长，反应迅速，可以频闪。

### 1.2.2 打光方式

- **低角度照明**：常用于检测平滑表面的变化部分，如划痕。

  <img src="./Images/机器视觉/图 1.3.png" alt="图 1.3" style="zoom:50%;" />

- **前向光直射照明**：亮度高，但是对表面平整度要求高

  <img src="./Images/机器视觉/图 1.4.png" alt="图 1.4" style="zoom:50%;" />

- **前向光漫射照明**：能够滤去物体表面纹理，更好呈现主要部分

  <img src="./Images/机器视觉/图 1.5.png" alt="图 1.5" style="zoom:50%;" />

- **背光照明**：能够表现出物体轮廓

### 1.2.3 镜头

镜头成像尺寸要大于等于摄像机芯片尺寸

- **视场**：系统能够观察到的物体的物理尺寸范围，也就是CCD芯片上所成图像最大时对应物体大小

- **光学倍率**：成像物体大小与尺寸的比值
  $$
  \mathrm{m=}\frac{s_{\mathrm{C}(VorH)}}{FOV_{(VorH)}}=\frac{f}{d_{W}}=\frac{NA\prime}{NA}
  $$
  **数值孔径**：数值孔径越大，镜头分辨率越高
  $$
  NA=n\cdot\sin u
  $$
  <img src="./Images/机器视觉/图 1.6.png" alt="图 1.6" style="zoom:50%;" />

- **焦距越小，视场角越大，拍摄距离越近**

  <img src="./Images/机器视觉/图 1.7.png" alt="图 1.7" style="zoom:50%;" />

- **分辨率**：镜头相对孔径越大，分辨率越高；光波长越短，分辨率越高；视场中心较边缘分辨率高；同档次固定焦镜头较变焦镜头分辨率高

- **光圈**：以镜头焦距f和通光孔径D的比值来衡量，数值越小，光圈越大，进光量越多，画面越亮，景深越短；数值越大，光圈越小，进光量越少，画面越暗，景深越长。

镜头分类

- **标准镜头**：视角约50°，也是人单眼在头和眼不转动的情况下能看到的视角
- **广角镜头**：视角90°以上，适用于拍摄距离近且范围大的景物
- **长焦距镜头**：适合拍摄距离远的景物，景深小容易使背景模糊主体突出
- **微距镜头**：极近距离微距拍摄

### 1.2.4 相机

<img src="./Images/机器视觉/图 1.8.png" alt="图 1.8" style="zoom:50%;" />

**面阵相机**：采集整幅图像

**线阵相机**：逐行扫描

**全局快门**：对于所有扫描线进行同时间一次曝光，类似将运动物体冻结

**卷帘快门**：逐行顺序曝光，不适合运动物体

工业相机一般采用黑白相机，同样分辨率下黑白相机精度更高，尤其是图像边缘

相机接口：

<img src="./Images/机器视觉/图 1.9.png" alt="图 1.9" style="zoom:50%;" />

## 1.3 软件相关

编译过程分为两个阶段，编译和链接。编译时吧文本形式的源代码翻译为机器语言形式的目标文件；链接是把目标文件、操作系统的启动代码和用到的库文件进行组织，形成最终可执行代码的过程。 

编译又分为两个阶段，编译和汇编。

编译阶段，编译器会对源代码进行预处理，然后把代码生成为汇编码，汇编阶段会把汇编码生成为目标机器所能读取的机器码。

```c++
Mat M1(2,2,CV_8UC3,Scalar(0,0,255));
/* 创建了一个名为M1的Mat，尺寸为2，2，类型为CV_8UC3
也就是8位uchar，三通道，初始化为(0,0,255)*/
Mat M3;
M3.create(3,4,CV_8UC3);
// 只创建，没有赋值
//----------------------------------------
// 浅复制：只指向同一个地址
Mat srcM(2,2,CV_8UC3,Scalar(0,0,255));
Mat dstM;
dstM = srcM;
// 深复制：创建一个新数据类型并拷贝
srcM.copyTo(dstM);
//---------------------------------------
// 利用指针.ptr遍历，指针指向每一行第一个通道的地址，逐行遍历
int height = image.rows;
int width = image.cols*image.channels();
for(int j=0; j<height; j++)
{
    uchar*data = image.ptr<uchar>(j);
    for(int i=0; i<width; i++)
    {
        data[i] = data[i]/2;
    }
}
// 利用.at遍历三通道，指针指向每个像素的第一个通道地址，逐像素遍历
int height = image.rows;
int width = image.cols;
for(int j=0; j<height; j++)
{
    for(int i=0; i<width; i++)
    {
        image.at<Vec3b>(j,i)[0] = image.at<Vec3b>(j,i)[0]/2;
        image.at<Vec3b>(j,i)[1] = image.at<Vec3b>(j,i)[1]/2;
        image.at<Vec3b>(j,i)[2] = image.at<Vec3b>(j,i)[2]/2;
    }
}
```

