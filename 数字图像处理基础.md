# 数字图像处理基础

## 1 概述

图像可以分为**模拟图像**和**数字图像**

- **模拟图像**可以通过某种物理量的强弱变化来记录图像亮度信息
- **数字图像**是用计算机存储的数据来记录图像上各点的亮度信息

**图像数字化**即将图像转化为数字图像，把图像分割成称为像素的小区域，每个像素都有亮度或灰度值，最终构成M*N的矩阵。

**数字图像处理**是利用计算机对图像进行去噪、增强、恢复、分割、提取特征等的理论方法技术。

数字图像处理的**目的**：

- 提高图像视觉质量，以达到赏心悦目的目的
- 提取图像中包含的某些特征或特殊信息，以便计算机分析
- 对图像数据进行变换、编码和压缩，以便于图像的存储的传输

数字图像处理的**内容**：

- **图像获取、表示、表现**：包括摄取图像、光电转换、数字化等步骤
- **图像增强**：强调图像的特征，便于进一步的分析和显示，用于改善图像感知质量采取的重要手段，包括去噪和提高对比度等。
- **图像恢复**：图像退化原因已知时，对图像进行校正以重新获得原始图像的过程。
- **图像重建**：由若干一维的投影重建出更高维的物体图像，输入是数据，输出是图像。
- **图像压缩**：降低代表数字图像的数据量，以减少数字图像传输时间和存储空间，编码是重要手段。
- **图像分割**：把图像分成区域的过程，从处理到分析转变的关键，图像分析的第一步。
- **图像分析**：从图像中分割、提取、描述某些特征，便于计算机对图像进行识别、理解，以产生有用的信息。

## 2 图像分类

**存在形式**

- 可见图像
- 不可见图像

**数模区分**

- 模拟图像：图像是连续的，用f(x,y)表示空间上某一点的某种性质，如亮度，灰度，色度。
- 数字图像：l(r,c)是离散化后的像素的参数

**色域区分**

- 黑白图像：像素值为0或1
- 灰度图像：每个像素的信息由灰度来表示，0是纯黑，255纯白
- 彩色图像：RGB组成不同灰度描述
- 索引图像：由二维矩阵和颜色索引矩阵MAP组成，只有预定的调色盘，一般只能同时显示256色

## 3 视觉原理

**人眼视觉特性**

1. **适应**：明暗亮度变化适应，从暗到亮叫亮适应，几秒钟；从亮到暗叫暗适应，三十秒
2. **绝对视觉阈值**：充分暗适应的状态下，在全黑视场中人眼能感受到的最小光刺激值。
3. **分辨力**：在空间上能区分相邻发光点的最小角距离称为极限分辨角$\theta$，倒数为人眼分辨力$\rho = 1/\theta$。
4. **马赫效应**：亮度发生跃变时，视觉上会感到边缘的亮侧更亮，暗侧更暗。
5. **视觉起始特性**：在加入阶跃光波刺激时所产生的感觉变化，在刺激几十毫秒后达到顶点，然后慢慢减少到一个常值，人眼视觉曲线的上升沿随着刺激光强的增加而缩短。
6. **视觉惰性**：人眼的亮度感觉不会随着物体亮度消失而立即消失，而有一个过渡时间，这称为视觉惰性。
7. **空间错觉**
8. **混色特性**：在同一时刻，当空间中由三种不同颜色的点，位置靠的足够近以至于相对于人眼所张的视角小于人眼的极限分辨角，人眼就不能分辨出它们的各自颜色，而只能感觉它们的混合色。

**色度学基础**

1. 三色原理：任何颜色都可以分解成红绿蓝三色光。
2. RGB模型
3. HIS模型：色度(Hue)、光强度(Intensity)、饱和度(Saturation)

**映射关系：**
$$
\begin{aligned}&\theta=\operatorname{arccos}\left\{{\frac{[(R-G)+(R-B)]/2}{\left[(R-G)^{2}+(R-B)(G-B)\right]^{1/2}}}\right\}\\
&H=\begin{cases}\theta\quad&\mathrm{G\geq B}\\2-\pi-\theta&\mathrm{G<B}&\end{cases}\\&S=1-\frac{3}{(R+G+B)}[\min(R,G,B)]\\&I={\frac{1}{\sqrt{3}}}(R+G+B)\end{aligned}
$$

$$
H=\begin{cases}\left(90^\circ+\tan^{-1}\left(\frac{2R-G-B}{\sqrt{3}\left(G-B\right)}\right)\right)\times255/360^\circ&G>B\\\\\left(90^\circ+\tan^{-1}\left(\frac{2R-G-B}{\sqrt{3}\left(G-B\right)}\right)+180^\circ\right)\times255/360^\circ&G<B\\\\255&G=B&\end{cases}
$$

**镜头畸变**：畸变产生原因是镜头中间部分放大率和周围的放大率不同。畸变会使得被测目标发生变形，一般来说焦距越短，视角越大，失真程度越大。

## 4 图像的数字化

**采样、编码、量化。**

- 采样间隔越大，所得图像像素数越少，分辨率越低；采样间隔越小，所得图像像素越多，分辨率越高，质量好，但数据量大。
- 量化等级越多，图像层次越丰富，灰度分辨率越高，质量越好，但数据量大；量化等级越少，图像层次欠丰富，灰度分辨率低，质量变差，会出现假轮廓现象。
- 非均匀采样：在灰度变化尖锐的区域采用细腻的采样，灰度级比较平滑的区域用粗糙的采样。
- 非均匀量化：在边界附近使用较少的灰度级，剩余灰度级可用于灰度变化比较平滑的区域。

## 5 像素关系

**邻域**

<img src="./Images/数字图像处理基础/图 1.png" alt="图 1" style="zoom:50%;" />

**邻接**

<img src="./Images/数字图像处理基础/图 2.png" alt="图 2" style="zoom:50%;" />

**连通**：从具有坐标$(x,y)$的像素$p$到具有坐标的像素序列，其坐标为:$(s,t)$的像素$q$的通路(或曲线)是特定的像素序列，其坐标为
$$
(x_0,y_0),(x_1,y_1),\cdots,(x_n,y_n)
$$
其中$(x_0,y_0)=(x,y),(x_n,y_n)=(s,t)$并且像素$(x_i,y_i)$ 和$(x_i-1,y_{i-1})$(对于 $1\leq i\leq n$)是邻接的。在这种情况下，n是通路的长度。如果$(x_0,y_0)=(x_n,y_n)$ ,则通路是闭合通路。

**区域**的定义建立在连通集基础上，令R是图像中的像素子集，如果R是连通集，则称R是一个区域。

如果一个点的8邻域都是1，则可以认为这个点是内部点，删除内部点可以得到边界。

**像素距离**

对于像素p、q和z，其坐标分别为$(x,y)$、$(s,t)$和$(v,w)$,如果函数D满足距离三要素，即：

(1) 非负性$D( p, q) \geq 0( D( p, q) = 0$,当且仅当$p=q)$

(2) 对称性,$D( p, q) = D( q, p)$

(3) 三角不等式，$D(p,z)\leq D(p,q)+D(q,z)$

- 欧氏距离：$D_e(p,q)=\sqrt{(x-s)^2+(y-t)^2}$

  <img src="./Images/数字图像处理基础/图 3.png" alt="图 3" style="zoom:50%;" />

- 城市街区距离(曼哈顿距离)：

  <img src="./Images/数字图像处理基础/图 4.png" alt="图 4" style="zoom:50%;" />

- 棋盘距离：

  <img src="./Images/数字图像处理基础/图 5.png" alt="图 5" style="zoom:50%;" />

## 6 灰度变换

灰度变换是根据某种目标条件按一定变换关系逐点改变原图像中每一个像素灰度值的方法，目的是为了改善画质，使图像显示效果更加清晰。

假设源图像像素的灰度值$D=f(x,y)$，处理后图像像素的灰度值$D’=g(x,y)$，则灰度变换可表示为:$g(x,y)=T[f(x,y)]$，其中，函数$T(D)$称为灰度变换函数，主要表示了输入灰度值和输出灰度值之间的转换关系。

**点运算**：在图像处理中，图像灰度变换和直方图修正属于点运算范畴，点运算的概念是，当算子T的作用域是以每一个单个像素为单位，图像的输出$g(x,y)$只与位置$(x,y)$处的输入$f(x,y)$有关，实现的是像素点到点的处理时，称这种运算为“点运算“。有时也被称为”灰度变换“、”对比度拉伸“、”对比度增强”

### 6.1 灰度线性变换

1. 图像反转
   $$
   s=L-1-r
   $$
   式中，$s$为反转目标图像某点的灰度值，$r$为原始图像对应点的灰度值，$L$为灰度级数。

   <img src="./Images/数字图像处理基础/图 6.png" alt="图 6" style="zoom:50%;" />

   

2. 线性变换

   在曝光度不足或过度的情况下，图像灰度可能会局限在一个很小的范围内。这时在显示器上看到的将是一个模糊不清、没有灰度层次的图像。用一个线性单值函数，对图像内的每一个像素做线性扩展，将有效地改善图像视觉效果。假定源图像$f(x,y)$的灰度范围为$[a,b]$，希望变换后图像$g(x,y)$的灰度范围扩展至$[c,d]$
   $$
   g\left(x,y\right)=\frac{d-c}{b-a}[f\left(x,y\right)-a]+c
   $$
   <img src="./Images/数字图像处理基础/图 7.png" alt="图 7" style="zoom:50%;" />

   超出此区间的灰度可以变换为常数或保持不变。

   - 当**k>1**时,则会使图像**对比度变大**，灰度取值的动态范围展宽;
   - 当**k=1**时,则灰度取值区间会随着a和c的大小上下**平移**，但灰度**动态范围不变**
   - 当**0<k<1**时，则变换后会使图像**对比度变小**，灰度取值的动态范围会变窄
   - 当**k<0**,则变换后图像的灰度值会发生**反转**，即图像中亮的变暗，暗的变亮。

3. 分段线性变换

   分段线性变换的优点是可以根据用户的需要，采用分段线性法，可将需要的图像细节灰度级拉抻，增强对比度，将不需要的细节灰度级压缩。
   $$
   g(x,y)=\begin{cases}\dfrac{M_g-d}{M_f-b}[f(x,y)-b]+d&\quad b\leq f(x,y)\leq M_f\\\dfrac{d-c}{b-a}[f(x,y)-a]+c&\quad a\leq f(x,y)<b\\\dfrac{c}{a}f(x,y)&\quad0\leq f(x,y)<a&\end{cases}
   $$
   <img src="./Images/数字图像处理基础/图 8.png" alt="图 8" style="zoom:33%;" />

4. 灰级窗

   将原图中一定范围内的灰度值映射到全灰度范围中，使对比度展宽获得更清晰图像，从而充分增强对比度，抑制非重要信息。
   $$
   g(i,j)=\begin{cases}0&0\leq f(i,j)<f_a\\K2(f(i,j)-f_a)&f_a\leq f(i,j)<f_b\\0&f_b\leq f(i,j)\leq255&\end{cases}\\(i=1,2,...,m;\quad j=1,2,...,n)
   $$
   式中$K2=255/(Fa-Fb)$，图像大小为$m\times n$。

   <img src="./Images/数字图像处理基础/图 9.png" alt="图 9" style="zoom:33%;" />

5. 灰度级分层

   一种是对感兴趣的$[a，b]$范围中灰度级以较大的灰度值$d$进行显示，而对另外的灰度级则以较小的灰度值$c$进行显示。从而突出了$[g，b]$间的灰度，而将其余灰度值变为低灰度值$c$。
   $$
   g(x,y)=\begin{cases}d&a\leq f(x,y)\leq b\\c&\text{其它}&\end{cases}
   $$
   <img src="./Images/数字图像处理基础/图 10.png" alt="图 10" style="zoom:33%;" />

   另一种方法是对感兴趣的灰度级d以较大的灰度值进行显示，而其他的灰度级则保持不变。
   $$
   g(x,y)=\begin{cases}d&a\leq f(x,y)\leq b\\f(x,y)&\text{其它}&\end{cases}
   $$
   <img src="./Images/数字图像处理基础/图 11.png" alt="图 11" style="zoom:33%;" />

### 6.2 灰度非线性变换

当某图像的像素集中于中间灰度部分，而其他部分的像素很少时，如果只想仔细地分析图像的某一部分，也就是对图像的那部分增强，我们可以压缩像素少的部分，扩展像素数集中的部分。

1. 对数变换

   对数变换对于整体对比度偏低并且灰度值偏低的图像增强效果较好。这种变换可用于增强图像的暗部细节，从而用来扩展被压缩的高值图像中的较暗像素

   $\mathrm{D_B=c\times\log(1+D_A)}$，式中c为尺度比较常数，DA为原始图像灰度值，DB为变换后的目标灰度值。

   <img src="./Images/数字图像处理基础/图 12.png" alt="图 12" style="zoom:43%;" />

   <img src="./Images/数字图像处理基础/图 13.png" alt="图 13" style="zoom:50%;" />

2. Gamma/指数变换

   $\mathrm{D_B}=\mathrm{c}\times\mathrm{D_A}^\gamma$

   - 当$\gamma>1$时，会拉伸图像中灰度级较高的区域，压缩灰度级较低的部分
   - 当$\gamma<1$时，会拉伸图像中灰度级较低的区域，压缩灰度级较高的部分
   - 当$\gamma=1$时，该灰度变换是线性的，此时通过线性方式改变原图像

### 6.3 灰度直方图

**灰度直方图**：对一幅图像，若统计出每一个灰度值的像素数并画出像素数-灰度值图形，称为灰度直方图。

**性质**：直方图是图像最基本的统计特征，只能反映图像灰度分布情况而不能反映像素位置；图像对应唯一灰度直方图，反之不成立；图像的灰度值方图是各部分之和。

**作用**：

- 直方图快速检查可以使数字化中问题尽早暴露，如是否有效利用动态范围。
- 可以确定二值化的阈值
- 分析原图像的亮暗程度，动态范围大小

**直方图均衡化**

在$[0,1]$区间内任何一个r，经变换函数$T(r)$都可以产生一个对应的s
$$
\mathbf{s}=\mathbf{T}(\mathbf{r})\quad0\leq\mathbf{r}\leq1
$$
$T(r)$应满足如下条件

1. 在$0\leq r\leq 1$内，$T(r)$单调递增（保证均衡化后灰度级次序不变且反变换存在）
2. 在$0\leq r\leq 1$内有$0\leq T(r)\leq 1$（保证映射变换后像素灰度值在允许范围内）

理论基础：
$$
F_s(s)=\int_{-\infty}^sp_s(s)ds=\int_{-\infty}^rp_r(r)dr\\
p_s(s)=\frac{\mathrm{d}F_s(s)}{\mathrm{d}s}=\frac{\mathrm{d}\left[\int_{-\infty}^rp_r(r)dr\right]}{\mathrm{d}s}=p_r(r)\frac{\mathrm{d}r}{\mathrm{d}s}=p_r(r)\frac{dr}{d[T(r)]}
$$
因此通过变换函数$T(r)$可以控制图像灰度级的概率密度函数。

对于灰度级为离散的数字图像，用频率代替概率，则变换函数$T(r_k)$的离散形式可以表示为
$$
s_k=T(r_k)=\sum_{j=0}^kp_r(r_j)=\sum_{j=0}^k\frac{n_j}{n}
$$
式中$r_k=\frac{k}{L-1}$表示归一化后的灰度级，k表示归一化前的灰度级，$0\leq r_k \leq1,k=0,1,2,\dots,L-1$。这个式子本质上是把变换前灰度所占比例的累积量转换为变化后的灰度。对变换后的数值，找到离它最近的灰度值作为变换后的灰度。变换后的灰度级减少，这种现象叫“简并”，是灰度有限的必然结果。