# 第 3 章 操作臂运动学

## 3.1 连杆的描述

**低副**：当两个刚体之间的相对运动时两个平面互相之间的相对滑动时，连接相邻两个刚体的运动副成为低副。

低副是面接触，高副是点接触或线接触。

设计操作臂结构时，通常优先选择仅具有一个自由度的关节作为连杆的连接方式，大部分操作臂中包括转动关节或移动关节。n自由度的关节可以看成用n个单自由度的关节把n-1个长度为0的连杆连接而成的。

关节轴之间的公垂线长度称为**连杆长度$a_{i}$**，把两个关节轴投影到同一平面，它们之间的夹角就是**连杆扭转角$\alpha_{i}$**，从轴线$i-1$转向$i$，为扭转角方向。利用上面两个参数，可以定义空间中任意两条关节轴之间的关系。

## 3.2 连杆连接的描述

相邻两个连杆之间有一个公共的关节轴，这两个连杆的公共轴线方向的距离称为**连杆偏距$d_{i}$**，绕公共轴线旋转的夹角称为**关节角$\theta_{i}$**。

<img src="./Images/第3章 操作臂运动学/图 3.1.png" alt="图 3.1" style="zoom:50%;" />

上图表示互相连接的连杆$i-1$和$i$，则$a_{i-1}$表示连接连杆$i-1$两端关节轴的公垂线长度，同样$a_i$表示连接连杆$i$两端关节轴的公垂线长度。连杆$i-1$与轴$i$的交点，和连杆$i$与轴$i$的交点之间的距离就是连杆偏距$d_i$，而$a_{i-1}$和$a_i$之间的夹角就是关节角$\theta_i$。当关节$i$是移动关节时，$d_i$是变量；当关节$i$是转动关节时，$\theta_i$是变量。

**对于运动链两端的连杆**，参数习惯设为0，即$a_0=a_n=0,\alpha_0=\alpha_n=0$，对于转动关节，$\theta_1$的零位可以任意选取，且$d_1=0$；对于移动关节，$d_1$的零位可以任意选取，设定$\theta_1=0$。关节n同理。

所以每个连杆都可以用四个运动学参数来描述，其中两个参数用于描述连杆本身，两个参数描述连杆之间的连接关系。对于转动关节，$\theta_i$为**关节变量**，其他三个为**连杆参数**；对于移动关节，$d_i$为关节变量，其他三个连杆参数固定不变。这种用连杆参数描述机构运动关系的规则称为$\mathrm{Denavit-Hartenberg}$ 方法。

## 3.3 连杆坐标系的定义

<img src="./Images/第3章 操作臂运动学/图 3.2.png" alt="图 3.2" style="zoom:33%;" />

固连在连杆i上的坐标系称为坐标系$\{i\}$，坐标系$\{i\}$的$\hat{Z}$轴称为$\hat{Z}_i$，并与关节轴$i$重合，坐标系$\{i\}$的原点位于公垂线$a_i$与关节轴$i$的交点处，$\hat{X}_i$沿$a_i$方向由关节i指向关节$i+1$。右手定则确定。

当$a_i=0$也就是两轴相交时，$\hat{X}_i$垂直于$\hat{Z}_i$和$\hat{Z}_{i+1}$所在平面，按右手定则绕$\hat{X}_i$转角定义为$\alpha_i$，$\hat{Y}_i$由右手定则确定。

**对于运动链两端的连杆**，固连于机器人基座上的坐标系为坐标系\{0\}，这是固定不动的坐标系，可以作为参考坐标系描述机械臂所有其他连杆坐标系的位置。

通常设定$\hat{Z}_0$沿关节轴1的方向，当关节变量1为0时，设定参考系$\{0\}$和坐标系$\{1\}$重合，所以总有$a_0=0,\alpha_0=0$。

对于转动关节$n$，设定$\theta_n=0$，此时$\hat{X}_N$轴与$\hat{X}_{N-1}$方向相同，选取坐标系$\{N\}$的原点使$d_n=0$；对于移动关节$n$，设定$d_n=0$，此时$\hat{X}_N$轴与$\hat{X}_{N-1}$相交于轴$n$，选取坐标系$\{N\}$的$\hat{X}_N$方向使$\theta_n=0$。

按照上述方法，连杆参数可以表示为
$$
\begin{aligned}
&a_{i}=\text{沿 }\hat{X}_i\text{ 轴 ,从 }\hat{Z}_i\text{ 移动到 }\hat{Z}_{i+1}\text{ 的距离}\\
&\alpha_{i}=\text{绕 }\hat{X}_i\text{ 轴 },\text{从 }\hat{Z}_i\text{ 旋转到 }\hat{Z}_{i+1}\text{ 的角度}\\
&d_{i}=\text{沿 }\hat{Z}_i\text{ 轴 },\text{从 }\hat{X}_{i-1}\text{ 移动到 }\hat{X}_i\text{ 的距离}\\
&\theta_{i}=\text{绕 }\hat{Z}_i\text{ 轴 },\text{从 }\hat{X}_{i-1}\text{ 旋转到 }\hat{X}_i\text{ 的角度}
\end{aligned}
$$
**建立连杆坐标系的步骤**

1. 找出各关节轴，标出延长线
2. 找出关节轴$i$和$i+1$之间的公垂线或关节轴$i$和$i+1$的交点，以交点或公垂线与关节轴$i$的交点作为连杆坐标系$\{i\}$的原点
3. 规定$\hat{Z}_i$轴沿关节轴i的指向
4. 规定$\hat{X}_i$沿公垂线的指向，如果关节轴$i$和$i+1$相交，规定$\hat{X}_i$轴垂直于关节轴$i$和$i+1$所在平面
5. 按照右手定则确定$\hat{Y}_i$轴
6. 当第一个关节变量为0时，规定坐标系$\{0\}$和$\{1\}$重合，对于坐标系$\{N\}$原点和$\hat{X}_N$方向可以任意选取，尽量使连杆参数为0。

## 3.4 操作臂运动学

对于坐标系$\{i\}$相对于坐标系$\{i-1\}$的变换，是由四个连杆参数构成的函数。对于任意给定的机器人，这个变换是只有一个变量的函数，另外三个由机械系统确定。

如果对每个连杆逐一构建坐标系，那这一问题可以分为四个子问题，分别是**$\hat{Z}_{i-1}$轴扭转$\alpha_{i-1}$**，**沿连杆$i-1$方向平移$a_{i-1}$**，**$\hat{X}_{i-1}$轴扭转$\theta_{i-1}$**，**沿轴$i$方向平移$d_{i}$**，分别对应三个中间坐标系$\left\{P\right\}\mathrm{、}\left\{Q\right\}\text{和}\left\{R\right\}$。

<img src="./Images/第3章 操作臂运动学/图 3.3.png" alt="图 3.3" style="zoom:33%;" />

所以把坐标系$\{i\}$中定义的矢量变换成坐标系$\{i-1\}$中的描述，变换矩阵可以写成
$$
\begin{aligned}^{i-1}P&={}_{R}^{i-1}T{}_{Q}^{R}T{}_{P}^{Q}T{}_{i}^{P}T{}^{i}P\\&^{i-1}P={}_{i}^{i-1}T{}^{i}P\\&_{i}^{i-1}T={}_{R}^{i-1}T{}_{Q}^{R}T{}_{P}^{Q}T{}_{i}^{P}T\end{aligned}
$$
对于每一个变换矩阵，可以写成
$$
_i^{i-1}T=R_X(\alpha_{i-1})D_X(a_{i-1})R_Z(\theta_i)D_Z(d_i)\\_i^{i-1}T=\mathrm{Screw}_X(a_{i-1},\alpha_{i-1})\mathrm{Screw}_Z(d_i,\theta_i)
$$
这里$\mathrm{Screw}_Q(r,\phi)$代表沿$\hat{Q}$轴平移$r$，再绕$\hat{Q}$轴旋转角度$\phi$ 的组合变换。
$$
\begin{aligned}
_i^{i-1}T&=\mathrm{Screw}_X(a_{i-1},\alpha_{i-1})\mathrm{Screw}_Z(d_i,\theta_i)\\
&=
\begin{pmatrix}
1 & 0 & 0 & a_{i-1}\\
0 & c\alpha_{i-1} & -s\alpha_{i-1} & 0\\
0 & s\alpha_{i-1} & c\alpha_{i-1} & 0\\
0 & 0 & 0 & 1
\end{pmatrix}
\begin{pmatrix}
c\theta_i & -s\theta_i & 0 & 0\\
s\theta_i & c\theta_i & 0 & 0\\
0 & 0 & 1 & d_i\\
0 & 0 & 0 & 1
\end{pmatrix}\\
&=\begin{pmatrix}
c\theta_i&-s\theta_i&0&a_{i-1}\\
s\theta_ic\alpha_{i-1}&c\theta_ic\alpha_{i-1}&-s\alpha_{i-1}&-s\alpha_{i-1}d_i\\
s\theta_is\alpha_{i-1}&c\theta_is\alpha_{i-1}&c\alpha_{i-1}&c\alpha_{i-1}d_i\\
0&0&0&1
\end{pmatrix}
\end{aligned}
$$
这是$_i^{i-1}T$的一般表达式。

进而，$\{N\}$相对于$\{0\}$的变换矩阵为
$$
{}_N^0T={}_1^0T{}_2^1T{}_3^2T{}\cdots{}_N^{N-1}T
$$
变换矩阵$^0_NT$是关于n个关节变量的函数。

## 3.5 驱动空间、关节空间和笛卡尔空间

对于一个有n个自由度的操作臂来说，它的所有连杆位置可由一组n个关节变量确定，这样的一组变量称为$n\times1$的**关节向量**。所有关节向量组成的空间称为**关节空间**。

当位置是在空间中相互正交的轴上测量，且姿态是按照第2章中任何一种规定测量时，我们称这个空间是**笛卡尔空间**。我们希望将一直的关节空间描述转化为在笛卡尔空间中的描述。

由于测量操作臂位置的传感器通常安装在驱动器上，所以进行控制器运算时必须把关节向量表示成一组驱动器变量方程，即**驱动向量**。

## 3.5 坐标系的标准命名

<img src="./Images/第3章 操作臂运动学/图 3.4.png" alt="图 3.4" style="zoom:33%;" />

- **基坐标系{B}**：基坐标系{B}位于操作臂基座上，其实就是坐标系{0}，有时也称为连杆0.
- **固定坐标系{S}**：固定坐标系与任务相关，位于机器人工作台的一个角上。对于用户来说，固定坐标系{S}是一个通用坐标系，机器人的所有运动都是相对于它来执行的，固定坐标系通常根据基坐标系来确定，即$^B_ST$。
- **腕部坐标系{W}**：腕部坐标系附着于操作臂的末端连杆，大多数情况下腕部坐标系的原点位于操作臂手腕上，随着操作臂的末端连杆移动，$\{W\}=^B_WT=^0_NT$。
- **工具坐标系{T}**：工具坐标系附着于机器人所夹持工具的末端，当手部没有夹持工具时，工具坐标系原点位于机器人指尖之间，通常相对于腕部坐标系来确定。
- **目标坐标系{G}**：目标坐标系是对机器人移动工具到达的位置描述，特指机器人在运动结束时，工具坐标系应当与目标坐标系重合。通常根据固定坐标系来确定。

机器人需要计算工具坐标系{T}相对于固定坐标系{S}的变换矩阵，只要通过运动学方程计算出$^B_WT$， 就可以得到工具的位置
$$
_T^ST={_S^B T^{-1}}{_W^BT}{_T^WT}
$$
**上述方程称为定位函数**，用于计算手臂的位置。根据连杆的几何形状，由基座端的广义变换矩阵$^B_ST$和另一端的执行器坐标变换矩阵$^W_TT$可以计算运动学方程$^S_TT$。







## 分析案例 PUMA560

<img src="./Images/第3章 操作臂运动学/图 3.5.png" alt="图 3.5" style="zoom:33%;" />

首先确定关节坐标系。关节1为旋转关节，轴竖直向上，关节2为旋转关节，轴指向纸面内。所以关节1坐标原点建立在轴1轴2交点，X轴垂直于轴1轴2.关节3在大臂另一端，轴向同关节2，关节2 X轴为轴2轴3公垂线，关节456耦合，关节轴相互垂直。

<img src="./Images/第3章 操作臂运动学/图 3.6.png" alt="图 3.6" style="zoom:33%;" />

由于所有关节都是旋转关节，所以$\theta_i$不为0。绕$\hat{X}_{i-1}$旋转$\hat{Z}_{i-1}$到$\hat{Z}_i$可以得到$\alpha_{i-1}$。大臂小臂长度$a_2、a_3$分别对应两个主轴之间距离。相邻X轴之间距离分别对应$d_3、d_4$。

<img src="./Images/第3章 操作臂运动学/图 3.7.png" alt="图 3.7" style="zoom:43%;" />

$\theta_i$分别是绕转$\hat{Z}_{0}$、$\hat{Y}_{1}$、$\hat{Z}_{2}$、$\hat{Y}_{3}$、$\hat{Y}_{4}$、$\hat{Y}_{5}$得到，所以每一个连杆变换矩阵为
$$
\begin{matrix}
_1^0T=
\begin{bmatrix}
c\theta_1&-s\theta_1&0&0\\
s\theta_1&c\theta_1&0&0\\
0&0&1&0\\
0&0&0&1
\end{bmatrix}
&
_2^1T=
\begin{bmatrix}
c\theta_2&-s\theta_2&0&0\\
0&0&1&0\\
-s\theta_2&-c\theta_2&0&0\\
0&0&0&1
\end{bmatrix}
\\
^2_3T=
\begin{bmatrix}
c\theta_3&-s\theta_3&0&a_2\\
s\theta_3&c\theta_3&0&0\\
0&0&1&d_3\\
0&0&0&1
\end{bmatrix}
&
^3_4T=
\begin{bmatrix}
c\theta_4&-s\theta_4&0&a_3\\
0&0&1&d_4\\
-s\theta_4&-c\theta_4&0&0\\
0&0&0&1
\end{bmatrix}
\\
^4_5T=
\begin{bmatrix}
c\theta_5&-s\theta_5&0&0\\
0&0&-1&0\\
s\theta_5&c\theta_5&0&0\\
0&0&0&1
\end{bmatrix}
&
^5_6T=
\begin{bmatrix}
c\theta_6&-s\theta_6&0&0\\
0&0&1&0\\
-s\theta_6&-c\theta_6&0&0\\
0&0&0&1
\end{bmatrix}
\end{matrix}
$$
先求$^3_6T=^3_4T^4_5T^5_6T$，由于关节2和关节3平行，所以可以用和差化积简化，最终$^0_6T=^0_1T^1_3T^3_6T$，求出运动学方程。
$$
_6^4T=_5^4T_6^5T=\begin{bmatrix}c_5c_6&-c_5s_6&-s_5&0\\s_6&c_6&0&0\\s_5c_6&-s_5s_6&c_5&0\\0&0&0&1\end{bmatrix}\\
^3_6T=^3_4T_{6}^{4}T=\begin{bmatrix}c_4c_5c_6-s_4s_6&-c_4c_5s_6-s_4c_6&-c_4s_5&a_3\\s_5c_6&-s_5s_6&c_5&d_4\\-s_4c_5c_6-c_4s_6&s_4c_5s_6-c_4c_6&s_4s_5&0\\0&0&0&1\end{bmatrix}\\
^1_3T=_2^1T_3^2T=\begin{bmatrix}c_{23}&-s_{23}&0&a_2c_2\\0&0&1&d_3\\-s_{23}&-c_{23}&0&-a_2s_2\\0&0&0&1\end{bmatrix}
$$
所以
$$
^1_6T=^1_3T_6^3T=\begin{bmatrix}^1r_{11}&^1r_{12}&^1r_{13}&^1p_x\\^1r_{21}&^1r_{22}&^1r_{23}&^1p_y\\^1r_{31}&^1r_{32}&^1r_{33}&^1p_z\\^10&0&0&1\end{bmatrix}
$$
式中
$$
\begin{aligned}
&^1r_{11}=c_{23}\left[c_4c_5c_6-s_4s_6\right]-s_{23}s_5s_6\\
&^1r_{21}=-s_4c_5c_6-c_4s_6\\
&^1r_{31}=-s_{23}\left[c_4c_5c_6-s_4s_6\right]-c_{23}s_5c_6\\
&^1r_{12}=-c_{23}\left[c_4c_5s_6+s_4c_6\right]+s_{23}s_5s_6\\
&^{1}r_{22}=s_4c_5s_6-c_4c_6\\
&^1r_{32}=s_{23}\begin{bmatrix}c_4c_5s_6+s_4c_6\end{bmatrix}+c_{23}s_5s_6\\
&^1r_{13}=-c_{23}c_4s_5-s_{23}c_5\\
&^1r_{23}=S_4S_5\\
&^1r_{33}=s_{23}c_4s_5-c_{23}c_5\\
&^{1}p_{x}=a_2c_2+a_3c_{23}-d_4s_{23}\\
&^1p_y=d_3\\
&^{1}p_{z}=-a_3s_{23}-a_2s_2-d_4c_{23}
\end{aligned}
$$
最后得到六个坐标系变换的结果
$$
_6^0T=_1^0T_6^1T=\begin{bmatrix}r_{11}&r_{12}&r_{13}&p_x\\r_{21}&r_{22}&r_{23}&p_y\\r_{31}&r_{32}&r_{33}&p_z\\0&0&0&1\end{bmatrix}
$$
式中
$$
\begin{aligned}
r_{11}&=c_1\left[c_{23}\left(c_4c_5c_6-s_4s_5\right)-s_{23}s_5c_6\right]+s_1\left(s_4c_5c_6+c_4s_6\right)\\
r_{21}&=s_1\left[c_{23}\left(c_4c_5c_6-s_4s_6\right)-s_{23}s_5c_6\right]-c_1\left(s_4c_5c_6+c_4s_6\right)\\
r_{31}&=-s_{23}(c_4c_5c_6-s_4s_6)-c_{23}s_5c_6\\
\\
r_{12}&=c_1\left[c_{23}\left(-c_4c_5s_6-s_4c_6\right)+s_{23}s_5s_6\right]+s_1\left(c_4c_6-s_4c_5s_6\right)\\
r_{22}&=s_1\left[c_{23}\left(-c_4c_5s_6-s_4c_6\right)+s_{23}s_5s_6\right]-c_1\left(c_4c_6-s_4c_5s_6\right)\\
r_{32}&=-s_{23}\left(-c_{4}c_{5}s_{6}-s_{4}c_{6}\right)+c_{23}s_{5}s_{6}\\
\\
r_{13}&=-c_{1}(c_{23}c_{4}s_{5}+s_{23}c_{5})-s_{1}s_{4}s_{5}\\
r_{23}&=-s_{1}\left(c_{23}c_{4}s_{5}+s_{23}c_{5}\right)+c_{1}s_{4}s_{5}\\
r_{33}&=s_{23}c_4s_5-c_{23}c_5\\
\\
p_{x}&=c_1\begin{bmatrix}a_2c_2+a_3c_{23}-d_4s_{23}\end{bmatrix}-d_3s_1\\
p_y&=s_1\begin{bmatrix}a_2c_2+a_3c_{23}-d_4s_{23}\end{bmatrix}+d_3c_1\\
p_z&=-a_3s_{23}-a_2s_2-d_4c_{23}\end{aligned}
$$
上面就是PUMA 560的运动学方程，它们说明如何计算机器人坐标系$\{6\}$相对于坐标系$\{0\}$的位置和姿态，是改操作臂所有运动学分析的基本方程。
